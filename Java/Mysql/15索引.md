## 索引

### 索引的作用

​	在数据库中，查询一张表有两种检索方式：全表扫描和根据索引检索。索引的效率很高，因为能缩小扫描范围。索引也是数据库中的对象，不能随意添加索引。如果表中的数据经常被修改，那么就不适合添加索引，因为数据一旦修改，索引需要重新排序，进行维护。

​	索引添加在字段上。`select ename, sla from emp where ename = 'SMITH';` 中，如果 `ename` 字段没有添加索引，那么以上 SQL 语句在执行的时候会进行全表扫描；当 `ename` 字段上添加索引时，以上 SQL 语句会根据索引扫描，快速定位。

### 索引的创建和删除
​	可以通过 `explain SQL语句` 命令查看 SQL 语句的执行计划。

​	查看 SQL 语句执行计划：

```mysql
mysql> explain select ename, sal from emp where sal = 5000;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | emp   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   14 |    10.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)
```

​	以上结果中 `type` 为 `all` 表示全表扫描。

​	创建索引：

```mysql
create index 索引名 on 表名(字段名);
create index emp_sal_index on emp(sal);
```



​	删除索引：

```mysql
# Oracle 中不需要加 on 表名
drop index 索引名 on 表名;
drop index emp_sal_index on emp;
```

### 创建索引的条件

+ 数据量庞大
  + 根据实际需求和线上环境
+ 字段的 DML 操作少
  + 因为字段修改时需要对索引进行维护
+ 字段经常出现在 `where` 子句中

### 自动添加索引

​	主键和具有 `unique` 约束的字段会自动添加索引。

### 索引的实现原理

​	索引的底层数据结构是 B + tree。给字段添加索引后，字段数据会先排序，分区，然后将数据存入 B + tree。

### 索引的分类

1. 单一索引
   + 单个字段添加索引
2. 复合索引
   + 多个字段联合添加一个索引
3. 主键索引
   + 主键会自动添加索引
4. 唯一索引
   + `unique` 约束的字段自动添加索引

### 索引的失效

```mysql
select ename from emp from where like '%A%';
```

​	这样无法确定第一个字符是什么。
