# 数据库实验报告

> 生信 2001 张子栋
>
> + GitHub: [MarkdownNotes/数据库实验报告.md at main · Bluuur/MarkdownNotes (github.com)](https://github.com/Bluuur/MarkdownNotes/blob/main/Data Base/数据库实验报告.md)
> + 同步至 Gitee: [Data Base/数据库实验报告.md · blur/MarkdownNotes (gitee.com)](https://gitee.com/bluur/MarkdownNotes/blob/main/Data Base/数据库实验报告.md)

## 实验三 学生-课程-选修

### 实验目的

熟练掌握建立数据库和表，向数据库输入数据、修改数据、删除数据的操作。

### 实验内容

建立数据库并设计各表，输入多条实际数据，并实现数据的增、删、改操作。

### 实验步骤

创建用于学生管理数据库，数据库名为 `StudentCourse`，包含学生的基本信息，课程信息和选课信息。数据库 `StudentCourse` 包含下列3个表：

1. student：学生基本信息。
2. course：课程信息表。
3. sc：学生选课表。

各表的结构分别如表1、表2和表3所示。

表1 学生信息表：student

| 列名  | 数据类型 | 长度 | 是否允许为空值 |
| :---: | :------: | :--: | :------------: |
|  sno  |  字符型  |  10  |       否       |
| sname |  字符型  |  10  |       否       |
| ssex  |  字符型  |  2   |       否       |
| sage  |  整数型  |      |       是       |
| sdept |  字符型  |  4   |       否       |

表2 课程信息表：course

|  列名  | 数据类型 | 长度 | 是否允许为空值 |
| :----: | :------: | :--: | :------------: |
|  cno   |  字符型  |  3   |       否       |
| cname  |  字符型  |  30  |       否       |
| credit |  整数型  |      |       是       |
|  pcno  |  字符型  |  3   |       是       |

表3 学生选课表：sc

| 列名  | 数据类型 | 长度 | 是否允许为空值 |
| :---: | :------: | :--: | :------------: |
|  sno  |  字符型  |  10  |       否       |
|  cno  |  字符型  |  3   |       否       |
| grade |  整数型  |      |       是       |

### SQL 语句

#### 建表语句

```sql
create table student
(
    sno   char(10),
    sname char(10),
    ssex  char(2),
    sage  int,
    sdept char(4)
);

create table course
(
    cno    char(3),
    cname  char(30),
    credit int,
    pcno   char(3)
);

create table sc
(
    sno   char(10),
    cno   char(3),
    grade int
);

```

#### 写入数据

> 这里使用 MySQL 完成, 可以一次插入多条数据.

```SQL
insert into student (sno, sname, ssex, sage, sdept)
values ('95001', '李勇', '男', 18, 'CS'),
       ('95002', '刘晨', '女', 19, 'IS'),
       ('95003', '王敏', '女', 18, 'MA'),
       ('95004', '张立', '男', 19, 'IS'),
       ('95005', '刘云', '女', 18, 'CS');

insert into course (cno, cname, credit, pcno)
values ('1', '数据库', 4, '5'),
       ('2', '数学', 6, null),
       ('3', '信息系统', 3, '1'),
       ('4', '操作系统', 4, '6'),
       ('5', '数据结构', 4, '7'),
       ('6', '数据处理', 3, null),
       ('7', 'PASCAL语言', 4, '6');

insert into sc (sno, cno, grade)
values ('95001', '1', 92),
       ('95001', '2', 85),
       ('95001', '3', 88),
       ('95002', '2', 90),
       ('95002', '3', 80),
       ('95003', '2', 85),
       ('95004', '1', 58),
       ('95004', '2', 85);
```

1. 查询全体学生的学号和姓名

   ```sql
   select sno, sname
   from student;
   ```

   <img src="Untitled.assets/image-20220505231951006.png" alt="image-20220505231951006" style="zoom:80%;" />

2. 查询选修了课程名为"数据库原理"的学生的学号和姓名

   ```sql
   select distinct student.sno, sname
   from student,
        sc,
        course
   where course.cno = sc.cno
     and student.sno = sc.sno
     and sc.cno = 1;
   ```

   <img src="Untitled.assets/image-20220505232052678.png" alt="image-20220505232052678" style="zoom:80%;" />

3. 查询全体学生的姓名, 出生年份,和所在系, 并用小写字母表示所有系名，并给各列指定列名。

   ```sql
   select sname name, 2022 - sage 'birth', lower(sdept) department
   from student;
   ```

   <img src="Untitled.assets/image-20220505232317856.png" alt="image-20220505232317856" style="zoom:80%;" />

4. 查询有多少名学生的数据库课程成绩不及格

   ```sql
   select count(cno) 'num'
   from sc
   where grade < 60
     and cno = 1;
   ```

   <img src="Untitled.assets/image-20220505232436523.png" alt="image-20220505232436523" style="zoom:80%;" />

5. 查找所有姓"李"的学生的姓名, 学号和性别

   ```sql
   select sname, sno, ssex
   from student
   where sname like '李%';
   ```

   <img src="Untitled.assets/image-20220505232522794.png" alt="image-20220505232522794" style="zoom:80%;" />

6. 求没有选修数学课程的学生学号

   ```sql
   select sno
   from student
   where sno not in (select sno from sc where cno = 2);
   ```

   <img src="Untitled.assets/image-20220505232548751.png" alt="image-20220505232548751" style="zoom:80%;" />

7. 查询选修了课程的学生的学号

   ```sql
   select distinct sno
   from student
   where sno in (select sno from sc);
   ```

   <img src="Untitled.assets/image-20220505232651208.png" alt="image-20220505232651208" style="zoom:80%;" />

8. 计算1号课程的学生的平均成绩, 最高分和最低分

   ```sql
   select avg(grade), max(grade), min(grade)
   from sc
   where cno = 1
   ```

   <img src="Untitled.assets/image-20220505232721919.png" alt="image-20220505232721919" style="zoom:80%;" />

9. 查询数学系和信息系的学生的信息

   ```sql
   select*
   from student
   where sdept in ('MA', 'IS');
   ```

   <img src="Untitled.assets/image-20220505232904839.png" alt="image-20220505232904839" style="zoom:80%;" />

10. 将年龄为19岁的学生的成绩置零

    ```sql
    update sc
    set grade=0
    where sno in (select sno from student where sage = 19);
    ```

    <img src="Untitled.assets/image-20220505233056040.png" alt="image-20220505233056040" style="zoom:80%;" />
    <img src="Untitled.assets/image-20220505233110148.png" alt="image-20220505233110148" style="zoom:80%;" />

11. 查询所有选修了1号课程的学生姓名

    ```sql
    select sname
    from student,
         sc
    where student.sno = sc.sno
      and cno = 1;
    ```

    <img src="Untitled.assets/image-20220505233235464.png" alt="image-20220505233235464" style="zoom:80%;" />

12. 对每一个性别，求学生的平均年龄，并把结果存入数据库

    ```sql
    create table sex_age
    (
        ssex    char(15),
        avg_age smallint
    );
    
    insert
    into sex_age(ssex, avg_age)
    select ssex, avg(sage)
    from student
    group by ssex;
    ```

    <img src="Untitled.assets/image-20220505233356145.png" alt="image-20220505233356145" style="zoom:80%;" />

13. 查询每个学生已获得的学分

    ```sql
    select sno, sum(credit)
    from course,
         sc
    where sc.cno = course.cno
    group by sno;
    ```

    <img src="Untitled.assets/image-20220505233428416.png" alt="image-20220505233428416" style="zoom:80%;" />

14. 将所有女生的记录定义为一个视图

    ```sql
    create view female_student
    as
    select*
    from student
    where ssex = '女';
    ```

    <img src="Untitled.assets/image-20220505233517198.png" alt="image-20220505233517198" style="zoom:80%;" />

15. 查询没有选修了1号课程的学生姓名

    ```sql
    select distinct sname
    from student,
         sc
    where student.sno not in (select sno from sc where cno = 1);
    ```

    <img src="Untitled.assets/image-20220505233603921.png" alt="image-20220505233603921" style="zoom:80%;" />

16. 将所有选修了数据库课程的学生的成绩加5分

    ```sql
    update sc
    set grade=grade + 5
    where cno = 1;
    ```

    <img src="Untitled.assets/image-20220505233702435.png" alt="image-20220505233702435" style="zoom:80%;" />
    <img src="Untitled.assets/image-20220505233803021.png" alt="image-20220505233803021" style="zoom:80%;" />

17. 查询各系的男女生学生总数, 并按系升序排列, 女生排在前

    ```sql
    select sdept, ssex, count(*) as num
    from student
    group by sdept, ssex
    order by sdept, ssex;
    ```

    <img src="Untitled.assets/image-20220505233938991.png" alt="image-20220505233938991" style="zoom:80%;" />

18. 查询"信息系"(IS)学生"数据结构"课程的平均成绩

    ```sql
    select avg(grade)
    from sc,
         student,
         course
    where student.sdept = 'IS'
      and student.sno = sc.sno
      and course.cname = '数据结构'
      and course.cno = sc.cno;
    ```

    > 原数据中没有给出此项成绩

    <img src="Untitled.assets/image-20220505234455179.png" alt="image-20220505234455179" style="zoom:80%;" />

19. 创建一个反映学生出生年份的视图

    ```sql
    create view birth(sno, sname, sbirth)
    as
    select sno, sname, 2022 - sage
    from student;
    ```

    <img src="Untitled.assets/image-20220505234539241.png" alt="image-20220505234539241" style="zoom:80%;" />

20. 查询与"王田"在同一个系学习的学生的信息

    ```sql
    select *
    from student
    where sdept in (select sdept from student where sname = '王田');
    ```

    > 原数据中没有给出此项数据

    <img src="Untitled.assets/image-20220505234912643.png" alt="image-20220505234912643" style="zoom:80%;" />

21. 查询年龄在20岁以下的学生的姓名及其年龄

    ```sql
    select sname, sage
    from student
    where sage < 20
    ```

    <img src="Untitled.assets/image-20220505234940605.png" alt="image-20220505234940605" style="zoom:80%;" />

22. 查询当前至少选修数据库和信息系统其中一门课的学生的学号

    ```sql
    select sno
    from sc,
         course
    where course.cname = '数据库'
      and course.cno = sc.cno
    union
    select sno
    from sc,
         course
    where course.cname = '信息系统'
      and course.cno = sc.cno;
    ```

    <img src="Untitled.assets/image-20220505235024007.png" alt="image-20220505235024007" style="zoom:80%;" />

23. 查询每个学生的学号, 姓名, 选修的课程名和成绩

    ```sql
    select student.sno, sname, cname, grade
    from student,
         course,
         sc
    where student.sno = sc.sno
      and sc.cno = course.cno;
    ```

    <img src="Untitled.assets/image-20220505235055315.png" alt="image-20220505235055315" style="zoom:80%;" />

24. 查找名字中包括“俊”的学生的姓名, 学号，选课课程和成绩

    ```sql
    select sname, student.sno, cname, grade
    from student,
         sc,
         course
    where sname like '%俊%';
    ```

    > 没有相关姓名的学生

    <img src="Untitled.assets/image-20220505235147476.png" alt="image-20220505235147476" style="zoom:80%;" />

25. 查询学分大于8的学生，输出学生的学号和学分

    ```sql
    select sno, sum(credit)
    from sc,
         course
    where sc.cno = course.cno
    group by sno
    having sum(credit) > 8;
    ```

    <img src="Untitled.assets/image-20220505235213843.png" alt="image-20220505235213843" style="zoom:80%;" />

26. 查询IS,CS,MA系的所有学生的姓名和性别

    ```sql
    select sname, ssex
    from student
    where sdept in ('IS', 'MA', 'CS');
    ```

    <img src="Untitled.assets/image-20220505235243380.png" alt="image-20220505235243380" style="zoom:80%;" />

27. 查询至少选修了2门课程的学生的平均成绩

    ```sql
    select avg(grade)
    from sc
    group by sno
    having count(*) >= 2;
    ```

    <img src="Untitled.assets/image-20220505235311683.png" alt="image-20220505235311683" style="zoom:80%;" />

28. 查询每个学生所选课程的平均成绩, 最高分, 最低分,和选课门数

    ```sql
    select sno, avg(grade), max(grade), min(grade), count(*)
    from sc
    group by sno;
    ```

    <img src="Untitled.assets/image-20220505235338558.png" alt="image-20220505235338558" style="zoom:80%;" />

29. 删除年龄大于21岁所有学生的选课记录

    ```sql
    delete
    from sc
    where sno in (select sno from student where sage > 21);
    ```

    > 不存在大于21岁的学生

30. 查询没有先行课的课程的课程号cno和课程名cname

    ```sql
    select cno, cname
    from course
    where pcno is null;
    ```

    <img src="Untitled.assets/image-20220505235550976.png" alt="image-20220505235550976" style="zoom:80%;" />

    
