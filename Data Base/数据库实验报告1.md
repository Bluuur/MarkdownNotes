# 数据库实验报告 1

> 生信 2001 张子栋
>
> + GitHub: [MarkdownNotes/数据库实验报告.md at main · Bluuur/MarkdownNotes (github.com)](https://github.com/Bluuur/MarkdownNotes/blob/main/Data Base/数据库实验报告.md)
> + 同步至 Gitee: [Data Base/数据库实验报告.md · blur/MarkdownNotes (gitee.com)](https://gitee.com/bluur/MarkdownNotes/blob/main/Data Base/数据库实验报告.md)

## 实验1 数据查询和更新

1. 找出所有客户、代理商和商品都在同一城市的三元组（cid, aid, pid）。

  ```sql
  select cid, aid, pid
  from agents,
       customers,
       products
  where agents.city = customers.city
    and customers.city = products.city;
  ```

2. 找出所有客户、代理商和商品不都在同一城市（可能有两个在同一城市）的三元组（cid, aid, pid）。

  ```sql
  select cid, aid, pid
  from agents,
       customers,
       products
  where agents.city != customers.city
     or customers.city != products.city;
  ```

3. 找出所有在同一城市的代理商的aid对。

  ```sql
  select first.aid, second.aid
  from agents first,
       agents second
  where first.city = second.city
    and first.aid != second.aid;
  ```

4. 找出同时订购了商品p01和p07的客户的cid值。（若找出客户的cname呢？）

  ```sql
  select orders.cid, cname
  from orders,
       customers
  where orders.pid = 'p01'
      intersect
  select orders.cid, cname
  from orders,
       customers
  where orders.pid = 'p07';
  ```

5. 统计各个产品的销售总量。

  ```sql
  select pid, sum(qty)
  from orders
  group by pid;
  ```

6. 当某个代理商所订购的某样产品的总量超过1000时，打印出所有满足条件的产品和代理商的ID以及这个总量。

  ```sql
  select pid, aid, sum(qty)
  from orders
  group by pid, aid
  having sum(qty) > 1000;
  ```

7. 找出订购了产品p05的顾客的名字。

  ```sql
  select distinct cname
  from customers,
       orders
  where orders.pid = 'p05'
    and customers.cid = orders.cid;
  ```

8. 检索满足以下条件的顾客-代理商的姓名对（cname,aname）,其中的顾客cname通过代理商aname订了货。

  ```sql
  select cname, aname
  from orders,
       customers,
       agents
  where customers.cid = orders.cid
    and agents.aid = orders.aid;
  ```

9. 找出至少被两个顾客订购的产品的pid值。

  ```sql
  select distinct pid
  from orders
  where pid in (select pid from orders group by pid having count(pid) > 1)
  ```

10. 在customers表中插入一个新行。

  ```sql
  insert into customers(cid, cname, city)
  values (‘c007’, ’WinDix’, ’Dallas’);
  ```

11. 检索customers表中discnt值为空的行。

   ```sql
   select*
   from customers
   where discnt is null
   ```

12. 检索客户以及他们订购商品的详细信息。（用外联接）

   ```sql
   select customers.cid,
          cname,
          city,
          discnt,
          ordno,
          month,
          aid,
          pid,
          qty,
          dollars
   from customers
            left outer join orders on (customers.cid = orders.cid)
   ```

13. 检索有关住在Duluth或Dallas的代理商的所有信息。（要求使用IN谓词实现）

   ```sql
   select*
   from agents
   where city in ('Duluth', 'Dallas')
   ```

14. 找出通过住在Duluth或Dallas的代理商订货的所有顾客的姓名和折扣率。（要求使用IN谓词实现）

   ```sql
   select cname, discnt
   from customers,
        orders
   where customers.cid = orders.cid
     and orders.aid in (select aid
                        from agents
                        where city in ('Duluth', 'Dallas'))
   ```

15. 求所有满足以下条件的顾客的cid值：该顾客的discnt的值小于任一住在Duluth的顾客的discnt值。

   ```sql
   select cid
   from customers
   where discnt < any (select discnt
                       from customers
                       where city = 'Duluth')
   ```

16. 检索没有通过代理商a05订货的所有顾客的名字。
      提示：可以使用not in 或 <>all方式实现。

   ```sql
   select cname
   from customers,
        orders
   where customers.cid = orders.cid
     and aid <> 'a05'
   ```

17. 检索一个包含顾客所在的或者代理商所在的城市的名称。（使用UNION实现）

   ```sql
   select city
   from customers
   union
   select city
   from agents
   ```

18. 在orders表中插入一个新行。

   ```sql
   insert into orders(ordno, month, cid, aid, pid)
   values (1107, 'aug', 'c006', 'a04', 'p01');
   ```

19. 创建一个名为swcusts的表，它包含住在西南部的所有顾客，并向该表中插入所有来自Dallas或Austin的顾客。

   ```sql
   insert into swcusts
   select *
   from customers
   where city in (‘Dallas’, ’Austin’);
   ```

20. 将所有住在New York的代理商的佣金率提高10%。

   ```sql
   update agents
   set per=per * 1.1
   where city = 'New York'
   ```

21. 删除所有住在New York的代理商。

   ```sql
   delete
   from agents
   where city = 'New York'
   ```

22. 创建一个agentorders视图，它扩展了表orders的行，包括订货的代理商的详细信息。

   ```sql
   create view agentorders
   as
   select ordno,
          month,
          cid,
          orders.aid,
          pid,
          qty,
          dollars,
          aname,
          city,
          per
   from orders,
        agents
   where orders.aid = agents.aid;
   ```

23. 利用agentorders视图查询代理商Brown的所有订单信息

   ```sql
   select ordno, motn, cid, pid, qty, dollars
   from agentorders
   where aname = ’Brown’;
   ```

24. 创建cacities视图，该视图列出表customers和表agents中所有配对的城市，其中该顾客通过该代理商订购了商品。

   ```sql
   create view cacities(cid.cname, city, discnt, aid, aname, per)
   as
   select customers.cid,
          cname,
          customers.city,
          discnt,
          agents.aid,
          aname,
          per
   from agents,
        customers,
        orders
   where agent.aid = orders.aid
     and customers.cid = orders.cid
     and agents.city = customers.city
   ```

   

25. 创建custs视图

   ```sql
   create view custs as
   select *
   from customers
   where discnt <= 15.0
   with check option;
   ```

26. 对custs视图进行更新操作。

   ```sql
   update custs set discnt=discnt+4;
   ```

