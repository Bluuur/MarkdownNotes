# 大豆根系微生物基因鉴定与基因功能预测分析流程

[toc]



以下过程均在 ` Ubuntu 18.04 bionic(on the Windows Subsystem for Linux)` 系统下完成。

本文连接：[MarkdownNotes/项目育人/大豆根系微生物基因鉴定与基因功能预测分析流程.md at main · Bluuur/MarkdownNotes (github.com)](https://github.com/Bluuur/MarkdownNotes/blob/main/项目育人/大豆根系微生物基因鉴定与基因功能预测分析流程.md)

All Rights Reserve (C) 2023 Zidong Zh.

<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="大豆根系微生物基因鉴定与基因功能预测分析流程.assets/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.



## 准备环境与输入文件

### 环境配置

#### Miniconda 安装

```bash
# 创建用于存放 Miniconda 的目录
mkdir miniconda 
# 下载指定版本的 Miniconda 安装脚本
wget https://repo.anaconda.com/miniconda/Miniconda3-py37_4.10.3-Linux-x86_64.sh 
# 运行安装脚本
bash Miniconda3-latest-Linux-x86_64.sh
# 完成安装后初始化 conda 环境
~/miniconda3/condabin/conda init
```

#### 解压 culturome 虚拟环境^[1]^

```bash
# 创建虚拟环境目录
mkdir ~/miniconda/envs/culturome
cd ~/miniconda/envs/culturome
# 下载虚拟环境
wget http://bailab.genetics.ac.cn/db/conda/culturome.tar.gz
# 解压虚拟环境
tar -xzvf culturome.tar.gz
# 激活 culturome 环境
conda activate culturome
conda unpack
rm culturome.tar.gz
```

#### 下载 Culturome Pipeline^[1]^

```bash
# 创建用于存放 Culturome Pipeline 的目录
mkdir /mnt/c/microbiome 
cd /mnt/c/microbiome
# clone 仓库
git clone git@github.com:YongxinLiu/Culturome.git 
# 添加执行权限
chmod +x Culturome/script/* 
# 设置环境变量便于使用命令脚本
echo export PATH=`pwd`/Culturome/script:\$PATH >>  ~/.bashrc 
# 搭建项目结构
wd=/mnt/d/culture
mkdir -p $wd && cd $wd
db=/mnt/c/microbiome/Culturome
mkdir -p seq temp result
```

#### 安装 VSEARCH

以下命令需在 culturome 虚拟环境下运行。

```bash
conda install -c bioconda vsearch
```



### 准备输入文件

#### 准备测序数据

双端测序数据存放位置：

```
/mnt/d/culturome/seq/
├── BeanRoot_1.clean.fq.gz
└── BeanRoot_2.clean.fa.gz
```

#### 编写样本信息（Metadata mapping file）

​	使用 R 手动编写并导出符合 QIMME2 要求（http://qiime.org/documentation/file_formats.html；访问于 2023 年 9 月）的 Metadata mapping file.

![image-20230920221832304](大豆根系微生物基因鉴定与基因功能预测分析流程.assets/image-20230920221832304.png)

+ 第一列（SampleID）和第二列（Barcode）为开展分析必需。
+ 第三列（LinkerPrimerSequence）、第四列（ReversePrimer）和最后列为使用 QIIME2 分析必需。
+ 其他列为自定义字段。

​	生成的 Metadata mapping file 存放位置：

```
/mnt/d/culturome/result
├── en_mapping.txt
└── rhi_mapping.txt
```

#### 检验 Metadata mapping file

```bash
cd /mnt/d/culturome/result
mkdir validateMappingFile
validate_mapping_file.py -m en_mapping.txt -o validateMappingFile
validate_mapping_file.py -m rhi_mapping.txt -o validateMappingFile
```

+ 输出 `No errors or warnings were found in mapping file.` 则 mapping file 无误。
+ 如果有错误，会在 `validateMappingFile` 目录下的 HTML 文件中高亮显示。

## 测序数据到扩增子

### 质量检测



### 双端序列合并



### 样本拆分

#### 切除 barcode

#### 序列按来源命名

### 统计每板每孔中测序读长

### 切除引物

## 代表性序列鉴定和物种注释

### 挑选代表序列

### 去除嵌合体

### 构建 ASV 表

### 假阳性率控制

### 物种注释

## 孔信息表和候选菌表

### 鉴定 ASV 非冗余菌

### 绘制 96 孔板纯度热图

## 物种树展示菌种分布

### 培养菌物种树绘制



## 参考文献

[1] Jingying Zhang, Yong-Xin Liu, Xiaoxuan Guo, Yuan Qin, Ruben Garrido-Oter, Paul Schulze-Lefert, Yang Bai. 2021. High-throughput cultivation  and identification of bacteria from the plant root microbiota. Nature Protocols 16: 988-1012. https://doi.org/10.1038/s41596-020-00444-7

